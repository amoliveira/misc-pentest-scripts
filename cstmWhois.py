#!/bin/python

""" 
Leonardo Militz

Simple whois in python with list searching support.
 
"""

import sys
import socket
import argparse

def whois(host):
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect(("whois.iana.org", 43)) # whois port
	s.send(host + "\r\n")
	res = s.recv(1024).split()
	res = res[res.index("refer:") + 1]
	s.close()
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect((res, 43))
	s.send(host + "\r\n")
	res = s.recv(1024)
	s.close()

	return res


host = ""
whois_list_name = ""

parser = argparse.ArgumentParser(description = 'Custom Whois by Leonardo Militz')
parser.add_argument('-d', action = 'store', dest = 'host', 
					required = True, help = 'target of your whois')
parser.add_argument('-l', action = 'store', dest = 'whois_list_name', 
					required = False, help = 'List with hosts to query', default = "")

arguments = parser.parse_args()

host = arguments.host
list_name = str(arguments.whois_list_name)

result = []
if list_name != "":
	
	with open(list_name) as f:
		lines = f.readlines()
		
		for host_name in lines:
			result.append(whois(host_name))
else:
	result.append(whois(host))

for whois in result:
	print("\n===================================================\n")
	print(whois)

print("\n===================================================\n")